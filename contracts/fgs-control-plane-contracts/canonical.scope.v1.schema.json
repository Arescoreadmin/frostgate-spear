{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://frostgate.io/schemas/fgs-control-plane-contracts/canonical.scope.v1.schema.json",
  "title": "Canonical Scope v1",
  "description": "Strict schema for campaign scope definition. Rejects vague scope per Blueprint v6.1 ยง4.2.2",
  "type": "object",
  "required": [
    "scope_id",
    "version",
    "assets",
    "boundaries",
    "exclusions",
    "time_window",
    "environment",
    "authorization_ref",
    "contact_on_call",
    "scope_hash"
  ],
  "properties": {
    "scope_id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for this scope definition"
    },
    "version": {
      "type": "string",
      "const": "1.0.0",
      "description": "Schema version"
    },
    "assets": {
      "type": "array",
      "minItems": 1,
      "description": "Strongly typed asset identifiers (inventory IDs), not free text",
      "items": {
        "type": "object",
        "required": ["asset_id", "asset_type", "inventory_ref"],
        "properties": {
          "asset_id": {
            "type": "string",
            "pattern": "^[A-Z]{2,4}-[0-9]{6,12}$",
            "description": "Standardized asset identifier"
          },
          "asset_type": {
            "type": "string",
            "enum": ["HOST", "NETWORK", "APPLICATION", "DATABASE", "CLOUD_RESOURCE", "CONTAINER", "API_ENDPOINT", "IDENTITY_STORE"],
            "description": "Asset classification type"
          },
          "inventory_ref": {
            "type": "string",
            "description": "Reference to asset in inventory system (CMDB, cloud provider, etc.)"
          },
          "metadata": {
            "type": "object",
            "properties": {
              "hostname": { "type": "string" },
              "ip_address": { "type": "string", "format": "ipv4" },
              "cloud_account": { "type": "string" },
              "resource_arn": { "type": "string" },
              "criticality": {
                "type": "string",
                "enum": ["LOW", "MEDIUM", "HIGH", "CRITICAL"]
              }
            }
          }
        }
      }
    },
    "boundaries": {
      "type": "object",
      "required": ["networks", "domains"],
      "description": "Explicit network and domain boundaries",
      "properties": {
        "networks": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["cidr", "description"],
            "properties": {
              "cidr": {
                "type": "string",
                "pattern": "^([0-9]{1,3}\\.){3}[0-9]{1,3}/[0-9]{1,2}$",
                "description": "CIDR notation network range"
              },
              "description": { "type": "string" },
              "vlan_id": { "type": "integer" },
              "zone": {
                "type": "string",
                "enum": ["DMZ", "INTERNAL", "MANAGEMENT", "PRODUCTION", "DEVELOPMENT", "STAGING"]
              }
            }
          }
        },
        "domains": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["domain", "scope_type"],
            "properties": {
              "domain": {
                "type": "string",
                "format": "hostname",
                "description": "Domain or subdomain in scope"
              },
              "scope_type": {
                "type": "string",
                "enum": ["EXACT", "WILDCARD_SUBDOMAIN"],
                "description": "Whether to include subdomains"
              }
            }
          }
        },
        "cloud_accounts": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["provider", "account_id"],
            "properties": {
              "provider": {
                "type": "string",
                "enum": ["AWS", "AZURE", "GCP", "OCI"]
              },
              "account_id": { "type": "string" },
              "regions": {
                "type": "array",
                "items": { "type": "string" }
              }
            }
          }
        }
      }
    },
    "exclusions": {
      "type": "array",
      "description": "Explicit exclusions from scope",
      "items": {
        "type": "object",
        "required": ["exclusion_type", "value", "reason"],
        "properties": {
          "exclusion_type": {
            "type": "string",
            "enum": ["ASSET", "NETWORK", "DOMAIN", "SERVICE", "USER", "TIME_WINDOW"]
          },
          "value": {
            "type": "string",
            "description": "The excluded item (asset ID, CIDR, domain, etc.)"
          },
          "reason": {
            "type": "string",
            "description": "Documented reason for exclusion"
          },
          "approved_by": {
            "type": "string",
            "description": "Approver who authorized this exclusion"
          }
        }
      }
    },
    "time_window": {
      "type": "object",
      "required": ["start", "end", "timezone"],
      "properties": {
        "start": {
          "type": "string",
          "format": "date-time",
          "description": "Campaign start time (ISO 8601)"
        },
        "end": {
          "type": "string",
          "format": "date-time",
          "description": "Campaign end time (ISO 8601)"
        },
        "timezone": {
          "type": "string",
          "description": "IANA timezone identifier"
        },
        "allowed_hours": {
          "type": "object",
          "description": "Optional daily time restrictions",
          "properties": {
            "start_hour": { "type": "integer", "minimum": 0, "maximum": 23 },
            "end_hour": { "type": "integer", "minimum": 0, "maximum": 23 },
            "days_of_week": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["MON", "TUE", "WED", "THU", "FRI", "SAT", "SUN"]
              }
            }
          }
        },
        "blackout_periods": {
          "type": "array",
          "description": "Periods when operations must cease",
          "items": {
            "type": "object",
            "required": ["start", "end", "reason"],
            "properties": {
              "start": { "type": "string", "format": "date-time" },
              "end": { "type": "string", "format": "date-time" },
              "reason": { "type": "string" }
            }
          }
        }
      }
    },
    "environment": {
      "type": "string",
      "enum": ["LAB", "STAGING", "PROD"],
      "description": "Target environment classification"
    },
    "authorization_ref": {
      "type": "object",
      "description": "Signed authorization reference for non-LAB environments",
      "required": ["ref_id", "type"],
      "properties": {
        "ref_id": {
          "type": "string",
          "description": "Reference to authorization document"
        },
        "type": {
          "type": "string",
          "enum": ["INTERNAL_APPROVAL", "SOW", "MSA", "PENTEST_AUTH", "BUG_BOUNTY", "ATO"],
          "description": "Type of authorization"
        },
        "issued_date": {
          "type": "string",
          "format": "date"
        },
        "expiry_date": {
          "type": "string",
          "format": "date"
        },
        "signature": {
          "type": "string",
          "description": "Cryptographic signature of authorization"
        },
        "signer_id": {
          "type": "string",
          "description": "Identity of authorizing party"
        }
      },
      "if": {
        "properties": {
          "type": { "not": { "const": "INTERNAL_APPROVAL" } }
        }
      },
      "then": {
        "required": ["ref_id", "type", "signature", "signer_id"]
      }
    },
    "contact_on_call": {
      "type": "object",
      "required": ["primary", "escalation_path"],
      "description": "Escalation contact for LIVE modes",
      "properties": {
        "primary": {
          "type": "object",
          "required": ["name", "email", "phone"],
          "properties": {
            "name": { "type": "string" },
            "email": { "type": "string", "format": "email" },
            "phone": { "type": "string" },
            "role": { "type": "string" }
          }
        },
        "secondary": {
          "type": "object",
          "properties": {
            "name": { "type": "string" },
            "email": { "type": "string", "format": "email" },
            "phone": { "type": "string" },
            "role": { "type": "string" }
          }
        },
        "escalation_path": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["level", "contact", "sla_minutes"],
            "properties": {
              "level": { "type": "integer", "minimum": 1 },
              "contact": { "type": "string" },
              "sla_minutes": { "type": "integer", "minimum": 1 }
            }
          }
        }
      }
    },
    "scope_hash": {
      "type": "string",
      "pattern": "^sha256:[a-f0-9]{64}$",
      "description": "SHA-256 hash computed over canonical JSON serialization of this scope object (excluding this field)"
    }
  },
  "additionalProperties": false
}
